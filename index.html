<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <!-- Google Fonts: Zen Maru Gothic -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- カスタムスタイル (css.html) の読み込み -->
  <?!= include('css'); ?>
</head>
<body class="bg-light d-flex flex-column min-vh-100">

  <!-- 全画面スピナー -->
  <div id="global-spinner" class="d-none">
    <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
      <span class="visually-hidden">読み込み中...</span>
    </div>
  </div>

  <!-- ナビゲーションヘッダー -->
  <nav class="navbar navbar-expand navbar-dark bg-primary shadow-sm sticky-top" id="main-nav" style="display: none;">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1 d-flex align-items-center">
        <i class="bi bi-stars me-2 text-warning"></i>
        <span id="nav-title"><ruby>冒険<rt>ぼうけん</rt></ruby>きろく</span>
      </span>
      <div class="d-flex align-items-center text-white" id="nav-user-info">
        <span class="me-3" id="nav-level-badge"><span class="badge bg-warning text-dark border"><ruby>Lv<rt>レベル</rt></ruby>. <span id="nav-level">--</span></span></span>
        <span class="me-3 fw-bold"><i class="bi bi-person-fill"></i> <span id="nav-nickname">----</span></span>
        <button class="btn btn-sm btn-outline-light d-none" id="btn-logout"><i class="bi bi-box-arrow-right"></i> <ruby>終了<rt>しゅうりょう</rt></ruby></button>
      </div>
    </div>
  </nav>

  <!-- 児童用ナビゲーションタブ -->
  <div class="container-fluid p-0 d-none" id="student-tabs">
    <div class="d-flex bg-white border-bottom shadow-sm">
      <button data-view="student-dashboard" class="flex-fill btn btn-link text-decoration-none rounded-0 py-3 fw-bold nav-tab active-tab">
        <i class="bi bi-house-door"></i> ホーム
      </button>
      <button data-view="student-myroom" class="flex-fill btn btn-link text-decoration-none rounded-0 py-3 fw-bold nav-tab text-secondary">
        <i class="bi bi-person-badge"></i> マイルーム
      </button>
      <button data-view="student-plaza" class="flex-fill btn btn-link text-decoration-none rounded-0 py-3 fw-bold nav-tab text-secondary">
        <i class="bi bi-people"></i> みんなの<ruby>広場<rt>ひろば</rt></ruby>
      </button>
    </div>
  </div>

  <!-- メインコンテンツ領域 -->
  <main class="container py-4 flex-grow-1" id="main-content">
    
    <!-- 初期ロード時のスケルトン -->
    <div id="initial-loading-view" class="text-center py-5">
      <div class="spinner-grow text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">データ<ruby>読<rt>よ</rt></ruby>み<ruby>込<rt>こ</rt></ruby>み<ruby>中<rt>ちゅう</rt></ruby>...</span>
      </div>
      <h3 class="fw-bold text-secondary">データ<ruby>準備中<rt>じゅんびちゅう</rt></ruby>...</h3>
    </div>

    <!-- =============== 教員用ビュー =============== -->
    <div id="teacher-dashboard" class="spa-view d-none">
      <h2 class="mb-4 text-primary"><i class="bi bi-clipboard-data"></i> 教員用ダッシュボード</h2>
      <div class="row g-4">
        <!-- 児童の詳細を確認 -->
        <div class="col-md-4">
          <div class="card h-100 shadow-sm border-info">
            <div class="card-header bg-info text-white fw-bold">
              <i class="bi bi-search"></i> 児童の詳細を確認
            </div>
            <div class="card-body">
              <label for="student-detail-select" class="form-label">児童を選択</label>
              <select id="student-detail-select" class="form-select mb-3">
                <option value="">選択してください...</option>
              </select>
              <button id="view-student-detail-btn" class="btn btn-info w-100 text-white fw-bold">詳細を見る</button>
            </div>
          </div>
        </div>

        <!-- ポイント配付 -->
        <div class="col-md-4">
          <div class="card h-100 shadow-sm border-warning">
            <div class="card-header bg-warning text-dark fw-bold">
              <i class="bi bi-gift"></i> ポイントを配布する
            </div>
            <div class="card-body">
              <label class="form-label">児童を選択（複数可）</label>
              <div id="grant-student-checkboxes" class="border rounded p-2 mb-3 bg-light custom-scrollbar" style="max-height: 150px; overflow-y: auto;">
                <!-- JSで表示 -->
              </div>
              <label class="form-label mb-1">配付するポイント</label>
              <div class="d-flex gap-2 mb-2">
                <input type="radio" class="btn-check" name="point-type" id="type-exp" value="exp" checked>
                <label class="btn btn-outline-warning text-dark flex-fill" for="type-exp">経験値</label>
                
                <input type="radio" class="btn-check" name="point-type" id="type-exchange" value="exchange">
                <label class="btn btn-outline-warning text-dark flex-fill" for="type-exchange">交換Pt</label>
              </div>
              <input type="number" id="point-amount" class="form-control mb-2" placeholder="配付量 (例: 100)">
              <input type="text" id="grant-reason" class="form-control mb-3" placeholder="理由 (任意)">
              <button id="grant-point-btn" class="btn btn-warning w-100 fw-bold">配布を実行する</button>
            </div>
          </div>
        </div>

        <!-- お知らせ管理 -->
        <div class="col-md-4">
          <div class="card h-100 shadow-sm border-success">
            <div class="card-header bg-success text-white fw-bold">
              <i class="bi bi-megaphone"></i> お知らせ管理
            </div>
            <div class="card-body d-flex flex-column">
              <textarea id="announcement-message" class="form-control mb-2" rows="3" placeholder="新しいお知らせを入力"></textarea>
              <button id="post-announcement-btn" class="btn btn-success w-100 fw-bold mb-3">投稿する</button>
              <hr>
              <h6 class="fw-bold text-success mb-2">投稿済みのお知らせ</h6>
              <div id="teacher-announcements-list" class="flex-grow-1 custom-scrollbar" style="max-height: 200px; overflow-y:auto;">
                <!-- JSで表示 -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- =============== 児童用ビュー (ホーム) =============== -->
    <div id="student-dashboard" class="spa-view d-none">
      <div class="row g-4">
        <!-- プロフィールカード -->
        <div class="col-md-4">
          <div class="card shadow-sm border-0 bg-white rounded-3">
            <div class="card-body text-center position-relative">
              <div class="avatar-container mx-auto mb-3 align-items-center justify-content-center d-flex" style="width: 150px; height: 150px; border: 2px dashed #ccc; border-radius: 50%;">
                <img id="dashboard-avatar" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" class="img-fluid rounded-circle shadow-sm" alt="アバター">
              </div>
              <h4 class="fw-bold mb-1"><span id="profile-nickname">--</span></h4>
              <p class="text-muted small mb-2"><i class="bi bi-person-fill"></i> <span id="profile-email">--</span></p>
              
              <div class="d-flex justify-content-between text-start mx-2 mt-3 bg-light rounded text-dark p-2">
                <div class="flex-fill text-center px-1 border-end border-white">
                  <div class="small fw-bold text-muted"><ruby>経験値<rt>けいけんち</rt></ruby></div>
                  <div class="fs-5 fw-bold text-primary"><span id="profile-exp">0</span></div>
                </div>
                <div class="flex-fill text-center px-1">
                  <div class="small fw-bold text-muted"><ruby>交換<rt>こうかん</rt></ruby>Pt</div>
                  <div class="fs-5 fw-bold text-warning"><span id="profile-exchange">0</span></div>
                </div>
              </div>

              <!-- 経験値バー -->
              <div class="mt-3 px-2">
                <div class="d-flex justify-content-between small fw-bold mb-1">
                  <span><ruby>次<rt>つぎ</rt></ruby>の<ruby>目標<rt>もくひょう</rt></ruby>へ</span>
                  <span id="exp-progress-text" class="text-primary">-- / --</span>
                </div>
                <div class="progress" style="height: 12px;">
                  <div id="exp-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" style="width: 0%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ミッションとお知らせ -->
        <div class="col-md-8">
          <div class="row g-4">
            <!-- ミッション -->
            <div class="col-12">
              <div class="card shadow-sm border-0 rounded-3">
                <div class="card-header bg-transparent border-0 pt-3 pb-0">
                  <h5 class="fw-bold text-primary"><i class="bi bi-list-check"></i> ミッション <span class="badge bg-danger rounded-pill" id="mission-badge-count" style="display:none;">!</span></h5>
                </div>
                <div class="card-body custom-scrollbar" style="max-height: 250px; overflow-y: auto;" id="missions-list">
                  <!-- ミッション一覧 -->
                </div>
              </div>
            </div>
            
            <!-- お知らせ -->
            <div class="col-md-6">
              <div class="card shadow-sm border-0 rounded-3 h-100">
                <div class="card-header bg-transparent border-0 pt-3 pb-0">
                  <h5 class="fw-bold text-success"><i class="bi bi-megaphone"></i> お<ruby>知<rt>し</rt></ruby>らせ</h5>
                </div>
                <div class="card-body custom-scrollbar" style="max-height: 200px; overflow-y: auto;" id="student-announcements">
                  <!-- お知らせ一覧 -->
                </div>
              </div>
            </div>

            <!-- 最近の記録 -->
            <div class="col-md-6">
              <div class="card shadow-sm border-0 rounded-3 h-100">
                <div class="card-header bg-transparent border-0 pt-3 pb-0">
                  <h5 class="fw-bold text-info"><i class="bi bi-clock-history"></i> <ruby>最近<rt>さいきん</rt></ruby>の<ruby>記録<rt>きろく</rt></ruby></h5>
                </div>
                <div class="card-body custom-scrollbar" style="max-height: 200px; overflow-y: auto;" id="recent-activity-log">
                  <!-- 最近の記録 -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- =============== 児童用ビュー (マイルーム) =============== -->
    <div id="student-myroom" class="spa-view d-none">
      <div class="row g-4">
        <div class="col-md-6">
          <div class="card shadow-sm border-0 rounded-3 mb-4">
            <div class="card-body position-relative">
              <h5 class="fw-bold text-primary mb-3"><i class="bi bi-magic"></i> ガチャを<ruby>引<rt>ひ</rt></ruby>く</h5>
              <div class="d-flex justify-content-around">
                <button id="btn-gacha-1" class="btn btn-primary d-flex flex-column align-items-center p-3 rounded-4 shadow hover-lift" style="min-width: 120px;">
                  <span class="fs-4 fw-bold mb-1">1<ruby>回<rt>かい</rt></ruby></span>
                  <span class="badge bg-light text-dark shadow-sm"><span id="cost-gacha-1">200</span>Pt</span>
                </button>
                <button id="btn-gacha-10" class="btn btn-warning text-dark d-flex flex-column align-items-center p-3 rounded-4 shadow hover-lift" style="min-width: 120px;">
                  <span class="fs-4 fw-bold mb-1">10<ruby>連<rt>れん</rt></ruby></span>
                  <span class="badge bg-light text-dark shadow-sm align-items-center d-flex gap-1"><i class="bi bi-star-fill text-danger" style="font-size: 0.6rem;"></i> <span id="cost-gacha-10">1800</span>Pt</span>
                </button>
              </div>
            </div>
          </div>

          <div class="card shadow-sm border-0 rounded-3 h-50">
             <div class="card-header bg-transparent border-0 pt-3 pb-0">
               <h5 class="fw-bold text-info"><i class="bi bi-bag-heart"></i> インベントリ</h5>
             </div>
             <div class="card-body">
               <div id="inventory-grid" class="d-flex flex-wrap gap-2 custom-scrollbar" style="max-height: 250px; overflow-y: auto;">
                 <!-- JSで追加 -->
               </div>
             </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card shadow-sm border-0 rounded-3 h-100">
            <div class="card-header bg-transparent border-0 pt-3 pb-0 d-flex justify-content-between align-items-center">
              <h5 class="fw-bold text-primary mb-0"><i class="bi bi-person-bounding-box"></i> アバター<ruby>構成<rt>こうせい</rt></ruby></h5>
              <button id="btn-save-avatar" class="btn btn-success btn-sm fw-bold px-3"><i class="bi bi-save"></i> <ruby>保存<rt>ほぞん</rt></ruby></button>
            </div>
            <div class="card-body">
              <div class="avatar-preview-box bg-light rounded text-center mb-3 py-3 position-relative mx-auto border" style="width: 200px; height: 200px;">
                <!-- 着せ替え用のプレビューレイヤー -->
                <div id="avatar-layers" class="w-100 h-100 position-relative">
                   <!-- 動的に追加 -->
                </div>
              </div>
              <p class="text-center text-muted small"><ruby>持<rt>も</rt></ruby>っているアイテムをタップして<ruby>着<rt>き</rt></ruby>せ<ruby>替<rt>か</rt></ruby>えよう！</p>
              
              <!-- プロフィール編集 -->
              <h6 class="fw-bold mt-4"><i class="bi bi-card-text"></i> プロフィール</h6>
              <div class="mb-2">
                <label class="form-label small text-muted fw-bold mb-1"><ruby>一言<rt>ひとこと</rt></ruby></label>
                <input type="text" id="profile-motto" class="form-control form-control-sm" placeholder="ひとこと入力...">
              </div>
              <div class="mb-2">
                <label class="form-label small text-muted fw-bold mb-1">すきなもの</label>
                <input type="text" id="profile-favorite" class="form-control form-control-sm" placeholder="すきなもの...">
              </div>
              <div class="mb-3">
                <label class="form-label small text-muted fw-bold mb-1"><ruby>目標<rt>もくひょう</rt></ruby></label>
                <input type="text" id="profile-goal" class="form-control form-control-sm" placeholder="これからの目標...">
              </div>
              <button id="btn-save-profile" class="btn btn-outline-primary btn-sm w-100 fw-bold"><ruby>設定<rt>せってい</rt></ruby>を<ruby>保存<rt>ほぞん</rt></ruby>する</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- =============== 児童用ビュー (みんなの広場) =============== -->
    <div id="student-plaza" class="spa-view d-none">
      <h3 class="fw-bold text-center text-primary mb-4"><i class="bi bi-people-fill"></i> みんなの<ruby>広場<rt>ひろば</rt></ruby></h3>
      <!-- 検索・絞り込みなどのヘッダーを入れることも可能 -->
      <div id="plaza-container" class="row g-3">
        <!-- JSで生成 -->
      </div>
    </div>

  </main>

  <!-- 固定フッター -->
  <footer class="text-center text-muted py-3 mt-auto border-top bg-white w-100">
    <small>© 2026 GIGA GamificationApp <a href="https://note.com/cute_borage86" target="_blank" class="text-decoration-none text-muted fw-bold">GIGA山</a></small>
  </footer>

  <!-- Bootstrap JS (モーダル等に必要) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- フロントエンドロジック (js.html) の読み込み -->
  <?!= include('js'); ?>
</body>
</html>
